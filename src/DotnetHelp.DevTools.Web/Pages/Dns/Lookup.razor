@page "/dns/lookup"
@using DotnetHelp.DevTools.Shared
@inject ApiHttpClient Http
@implements IAsyncDisposable

<PageTitle>Dns Lookup</PageTitle>

<PageHeader Title="Dns"
			SubTitle="Dns Lookup"
			Details=@(new List<string> {
			$"Lookup Dns records for a given domain"
			}) />

<section class="mb-8 relative">

	<label class="block mb-4">
		<span class="block text-gray-700 dark:text-gray-400 mb-2">Domain</span>
		<InputText @bind-Value="_request" class="w-full text-sm leading-6 text-slate-400 rounded-md ring-1 ring-slate-900/10 shadow-sm py-1.5 pl-2 pr-3 hover:ring-slate-300 dark:bg-slate-800 dark:highlight-white/5 dark:hover:bg-slate-700" placeholder="Enter some text."></InputText>
	</label>

	<div class="flex justify-end">
		<div>
			<button @onclick="OnClick" type="button" class="bg-sky-500 hover:bg-sky-700 px-5 py-2 text-sm leading-5 rounded-full font-semibold text-white">
				Lookup
			</button>
		</div>
	</div>


</section>

@if (_response is not null)
{
	<section class="mb-8 relative">

		<span class="block text-gray-700 dark:text-gray-400 mb-2">Result</span>

		<div class="not-prose relative bg-slate-50 rounded-xl overflow-hidden dark:bg-slate-800/25">
			<div style="background-position:10px 10px" class="absolute inset-0 bg-grid-slate-100 [mask-image:linear-gradient(0deg,#fff,rgba(255,255,255,0.6))] dark:bg-grid-slate-700/25 dark:[mask-image:linear-gradient(0deg,rgba(255,255,255,0.1),rgba(255,255,255,0.5))]"></div><div class="relative rounded-xl overflow-auto p-8">
				<div class="space-y-8">
					<div>
						<div class="text-sm font-medium text-slate-900 dark:text-slate-200">
							@foreach (var record in _response.Responses)
							{
								<ul>
									<li class="mb-2">
										<span>
											<span class="text-sm text-sky-500 whitespace-nowrap dark:text-sky-400">@record.Type : </span>
											<span class="text-wrap break-all text-sm">@record.Address</span>
										</span>
									</li>
								</ul>
							}
						</div>
					</div>
				</div>
			</div><div class="absolute inset-0 pointer-events-none border border-black/5 rounded-xl dark:border-white/5"></div>
		</div>

	</section>
}


@code {
	private string? _request;
	private DnsLookupResponses? _response;
	readonly CancellationTokenSource _disposalTokenSource = new();

	protected override Task OnInitializedAsync()
	{
		return Task.CompletedTask;
	}

	public async ValueTask DisposeAsync()
	{
		await _disposalTokenSource.CancelAsync();
	}

	private async Task OnClick()
	{
		if (!string.IsNullOrWhiteSpace(_request))
		{
			_response = await Http.DnsLookup(_request, _disposalTokenSource.Token);
			StateHasChanged();
		}
	}
}