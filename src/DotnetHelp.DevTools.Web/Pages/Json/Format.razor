@page "/json/format"
@using DotnetHelp.DevTools.Shared
@using System.Net

<PageTitle>Json Format</PageTitle>

<DnhHeader Title="Json"
		   SubTitle="Json Format"
		   Details=@(new List<string> {
		   $"Try and format a json string into something more readable"
		   }) />

<DnhSection>
	<DnhForm OnSubmit="OnSubmit" Text="Format">
		<DnhTextArea Label="Input" @bind-Value="_request" />
	</DnhForm>
</DnhSection>

@if (_response is not null)
{
	<DnhSection>
		<DnhResult>
			<pre>@_response</pre>
		</DnhResult>
	</DnhSection>
}

@code {
	private string? _request;
	private string? _response;
	private readonly CancellationTokenSource _disposalTokenSource = new();

	public async ValueTask DisposeAsync()
	{
		await _disposalTokenSource.CancelAsync();
	}

	private void OnSubmit()
	{
		if (!string.IsNullOrWhiteSpace(_request))
		{
			_response = JsonSerializer.Serialize(JsonSerializer.Deserialize<object>(_request), new JsonSerializerOptions { WriteIndented = true });
			StateHasChanged();
		}
	}
}